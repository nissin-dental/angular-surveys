angular.module("mwFormBuilder",["ngSanitize","ng-sortable","pascalprecht.translate"]),angular.module("mwFormBuilder").service("mwFormUuid",function(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}this.get=function(){return e()+e()+e()+e()+e()+e()+e()+e()}}).factory("mwFormClone",["mwFormUuid",function(e){var n={},o=[];return n.resetIds=function(t,r){if(r&&(o=[]),!(o.indexOf(t)>=0)&&(o.push(t),!t!==Object(t))){if(Array.isArray(t))return void t.forEach(n.resetIds);for(var i in t)t.hasOwnProperty(i)&&n.resetIds(t[i]);if(t.hasOwnProperty("id")){var a=e.get();t.id;t.id=a}}},n.cloneElement=function(e){var o={};return angular.copy(e,o),n.resetIds(o,!0),o},n.clonePage=function(o){var t={};angular.copy(o,t),t.id=e.get();var r=[];if(Array.isArray(o.elements))for(var i=0;i<o.elements.length;i++)r.push(n.cloneElement(o.elements[i]));return t.elements=r,t},n.cloneForm=function(e){var o={};angular.copy(e,o);var t=[];if(Array.isArray(e.pages))for(var r=0;r<e.pages.length;r++)t.push(n.clonePage(e.pages[r]));return o.pages=t,o},n}]),angular.module("mwFormBuilder").directive("mwQuestionPriorityListBuilder",function(){return{replace:!0,restrict:"AE",require:"^mwFormQuestionBuilder",scope:{question:"=",readOnly:"=?",options:"=?"},templateUrl:"mw-question-priority-list-builder.html",controllerAs:"ctrl",bindToController:!0,controller:["mwFormUuid",function(e){function n(e){if(e)for(var n=0;n<e.length;n++){var o=e[n];o.orderNo=n+1}}function o(e){e.sort(function(e,n){return e.orderNo-n.orderNo})}var t=this;t.isNewItem={},this.$onInit=function(){t.question.priorityList||(t.question.priorityList=[],t.addNewItem()),o(t.question.priorityList),t.itemsSortableConfig={disabled:t.readOnly,ghostClass:"beingDragged",handle:".drag-handle",onEnd:function(e,o){n(t.question.priorityList)}}},t.addNewItem=function(n){var o={id:e.get(),orderNo:t.question.priorityList.length+1,value:null};n||(t.isNewItem[o.id]=!0),t.question.priorityList.push(o)},t.removeItem=function(e){var n=t.question.priorityList.indexOf(e);n!=-1&&t.question.priorityList.splice(n,1)},t.keyPressedOnInput=function(e,n){delete t.isNewItem[n.id],13===e.which&&(e.preventDefault(),t.addNewItem())},1===angular.version.major&&angular.version.minor<5&&this.$onInit()}],link:function(e,n,o,t){e.ctrl}}}),angular.module("mwFormBuilder").directive("mwQuestionOfferedAnswerListBuilder",function(){return{replace:!0,restrict:"AE",require:"^mwFormQuestionBuilder",scope:{question:"=",formObject:"=",readOnly:"=?",options:"=?",disableOtherAnswer:"=?"},templateUrl:"mw-question-offered-answer-list-builder.html",controllerAs:"ctrl",bindToController:!0,controller:["FormQuestionBuilderId","mwFormUuid",function(e,n){function o(){if(r.question.offeredAnswers)for(var e=0;e<r.question.offeredAnswers.length;e++){var n=r.question.offeredAnswers[e];n.orderNo=e+1}}function t(){r.question.offeredAnswers&&r.question.offeredAnswers.sort(function(e,n){return e.orderNo-n.orderNo})}var r=this;this.$onInit=function(){if(r.config={radio:{},checkbox:{}},r.isNewAnswer={},t(),r.offeredAnswersSortableConfig={disabled:r.readOnly,ghostClass:"beingDragged",handle:".drag-handle",onEnd:function(e,n){o()}},0===r.question.offeredAnswers.length){var e=!1,n=function(){r.question.offeredAnswers.length<2&&(r.addNewOfferedAnswer(e),n())};n()}},r.addNewOfferedAnswer=function(e){var o=null!=r.possiblePageFlow?r.possiblePageFlow[0]:{nextPage:!0,label:"target.mwForm.pageFlow.goToNextPage"},t={id:n.get(),orderNo:r.question.offeredAnswers.length+1,value:null,pageFlow:o,explanation:"",correctAnswer:!1};null!=e&&e!==!0||(r.isNewAnswer[t.id]=!0),r.question.offeredAnswers.push(t)},r.removeOfferedAnswer=function(e){var n=r.question.offeredAnswers.indexOf(e);n!=-1&&r.question.offeredAnswers.splice(n,1)},r.addCustomAnswer=function(){r.question.otherAnswer=!0},r.removeCustomAnswer=function(){r.question.otherAnswer=!1},r.keyPressedOnInput=function(e,n){delete r.isNewAnswer[n.id],13===e.which&&(e.preventDefault(),r.addNewOfferedAnswer())},r.updateMaxCorrectAnswers=function(e){"radio"===r.question.type&&r.question.offeredAnswers.forEach(function(n){n.id!=e.id&&(n.correctAnswer=!1)})},1===angular.version.major&&angular.version.minor<5&&this.$onInit()}],link:function(e,n,o,t){var r=e.ctrl;r.possiblePageFlow=t.possiblePageFlow}}}),angular.module("mwFormBuilder").directive("mwQuestionGridBuilder",function(){return{replace:!0,restrict:"AE",require:"^mwFormQuestionBuilder",scope:{question:"=",formObject:"=",readOnly:"=?",options:"=?"},templateUrl:"mw-question-grid-builder.html",controllerAs:"ctrl",bindToController:!0,controller:["mwFormUuid","MW_GRID_CELL_INPUT_TYPES",function(e,n){function o(e){if(e)for(var n=0;n<e.length;n++){var o=e[n];o.orderNo=n+1}}function t(e){e.sort(function(e,n){return e.orderNo-n.orderNo})}var r=this;this.$onInit=function(){r.cellInputTypes=n,r.isNewInput={},r.question.grid||(r.question.grid={rows:[],cols:[]},r.addNewRow(),r.addNewCol(!0)),r.question.grid.cellInputType||(r.question.grid.cellInputType=r.cellInputTypes[0]),t(r.question.grid.rows),t(r.question.grid.cols),r.rowsSortableConfig={disabled:r.readOnly,ghostClass:"beingDragged",handle:".drag-handle",onEnd:function(e,n){o(r.question.grid.rows)}},r.colsSortableConfig={disabled:r.readOnly,ghostClass:"beingDragged",handle:".drag-handle",onEnd:function(e,n){o(r.question.grid.cols)}}},r.addNewRow=function(n){var o={id:e.get(),orderNo:r.question.grid.rows.length+1,label:null};n||(r.isNewInput[o.id]=!0),r.question.grid.rows.push(o)},r.addNewCol=function(n){var o={id:e.get(),orderNo:r.question.grid.cols.length+1,label:null};n||(r.isNewInput[o.id]=!0),r.question.grid.cols.push(o)},r.removeRow=function(e){var n=r.question.grid.rows.indexOf(e);n!=-1&&r.question.grid.rows.splice(n,1)},r.removeCol=function(e){var n=r.question.grid.cols.indexOf(e);n!=-1&&r.question.grid.cols.splice(n,1)},r.keyPressedOnInput=function(e,n,o){delete r.isNewInput[n.id],13===e.which&&(e.preventDefault(),"row"==o?r.addNewRow():r.addNewCol())},1===angular.version.major&&angular.version.minor<5&&this.$onInit()}],link:function(e,n,o,t){e.ctrl}}}),angular.module("mwFormBuilder").directive("mwQuestionDivisionBuilder",function(){return{replace:!0,restrict:"AE",require:"^mwFormQuestionBuilder",scope:{question:"=",readOnly:"=?",options:"=?"},templateUrl:"mw-question-division-builder.html",controllerAs:"ctrl",bindToController:!0,controller:["mwFormUuid",function(e){function n(e){if(e)for(var n=0;n<e.length;n++){var o=e[n];o.orderNo=n+1}}function o(e){e.sort(function(e,n){return e.orderNo-n.orderNo})}var t=this;t.$onInit=function(){t.isNewItem={},t.question.divisionList||(t.question.divisionList=[],t.addNewItem()),o(t.question.divisionList),t.itemsSortableConfig={disabled:t.readOnly,ghostClass:"beingDragged",handle:".drag-handle",onEnd:function(e,o){n(t.question.divisionList)}}},t.addNewItem=function(n){var o={id:e.get(),orderNo:t.question.divisionList.length+1,value:null};n||(t.isNewItem[o.id]=!0),t.question.divisionList.push(o)},t.removeItem=function(e){var n=t.question.divisionList.indexOf(e);n!=-1&&t.question.divisionList.splice(n,1)},t.keyPressedOnInput=function(e,n){delete t.isNewItem[n.id],13===e.which&&(e.preventDefault(),t.addNewItem())},1===angular.version.major&&angular.version.minor<5&&t.$onInit()}],link:function(e,n,o,t){e.ctrl}}}),angular.module("mwFormBuilder").directive("mwLabel",function(){return{replace:!0,restrict:"AE",scope:{labelKey:"@?",labelText:"@?",labelFor:"@",labelClass:"@",labelTranslateValues:"="},templateUrl:"mw-label.html",controllerAs:"ctrl",bindToController:!0,controller:["mwFormUuid",function(e){}],link:function(e,n,o){}}}),angular.module("mwFormBuilder").factory("FormQuestionBuilderId",function(){var e=0;return{next:function(){return++e}}}).directive("mwFormQuestionBuilder",function(){return{replace:!0,restrict:"AE",require:"^mwFormPageElementBuilder",scope:{question:"=",formObject:"=",onReady:"&",isPreview:"=?",readOnly:"=?"},templateUrl:"mw-form-question-builder.html",controllerAs:"ctrl",bindToController:!0,controller:["$timeout","FormQuestionBuilderId","mwFormBuilderOptions","$rootScope",function(e,n,o,t){function r(){if(l.question.offeredAnswers)for(var e=0;e<l.question.offeredAnswers.length;e++)l.question.offeredAnswers[e].orderNo=e+1}function i(){l.question.offeredAnswers&&l.question.offeredAnswers.sort(function(e,n){return e.orderNo-n.orderNo})}function a(){l.question.offeredAnswers&&l.question.offeredAnswers.forEach(function(e){l.question.pageFlowModifier?e.pageFlow=l.possiblePageFlow[0]:delete e.pageFlow})}var l=this;l.$onInit=function(){l.id=n.next(),l.questionTypes=o.questionTypes,l.formSubmitted=!1,i(),l.offeredAnswersSortableConfig={disabled:l.readOnly,ghostClass:"beingDragged",handle:".drag-handle",onEnd:function(e,n){r()}}},l.save=function(){l.formSubmitted=!0,l.form.$valid&&("radio"===l.question.type||"checkbox"===l.question.type?l.question.offeredAnswers.length>1&&l.onReady():l.onReady())},t.$on("validateForm",function(){l.save()});var s=["radio","checkbox"];l.questionTypeChanged=function(){s.indexOf(l.question.type)!==-1&&(l.question.offeredAnswers?null!=l.question.offeredAnswers&&l.question.offeredAnswers.length>1&&"radio"===l.question.type&&l.question.offeredAnswers.forEach(function(e){e.correctAnswer=!1}):l.question.offeredAnswers=[]),"radio"!=l.question.type&&(a(),e(function(){l.question.pageFlowModifier=!1})),s.indexOf(l.question.type)===-1&&delete l.question.offeredAnswers,"grid"!=l.question.type&&delete l.question.grid,"priority"!=l.question.type&&delete l.question.priorityList},l.pageFlowModifierChanged=function(){a()},1===angular.version.major&&angular.version.minor<5&&l.$onInit()}],link:function(e,n,o,t){var r=e.ctrl;r.possiblePageFlow=t.possiblePageFlow,r.options=t.options}}}),angular.module("mwFormBuilder").factory("FormParagraphBuilderId",function(){var e=0;return{next:function(){return++e}}}).directive("mwFormParagraphBuilder",function(){return{replace:!0,restrict:"AE",require:"^mwFormPageElementBuilder",scope:{paragraph:"=",formObject:"=",onReady:"&",isPreview:"=?",readOnly:"=?"},templateUrl:"mw-form-paragraph-builder.html",controllerAs:"ctrl",bindToController:!0,controller:["$timeout","FormParagraphBuilderId","$rootScope",function(e,n,o){var t=this;t.$onInit=function(){t.id=n.next(),t.formSubmitted=!1},t.save=function(){t.formSubmitted=!0,t.form.$valid&&t.onReady()},o.$on("validateForm",function(){t.save()}),1===angular.version.major&&angular.version.minor<5&&t.$onInit()}],link:function(e,n,o,t){e.ctrl}}}),angular.module("mwFormBuilder").directive("mwFormPageElementBuilder",function(){return{replace:!0,restrict:"AE",require:"^mwFormPageBuilder",scope:{pageElement:"=",formObject:"=",isActive:"=",isFirst:"=",isLast:"=",onReady:"&",readOnly:"=?",uploadUrl:"="},templateUrl:"mw-form-page-element-builder.html",controllerAs:"ctrl",bindToController:!0,controller:["mwFormUuid",function(e){var n=this;n.$onInit=function(){"question"==n.pageElement.type?n.pageElement.question||(n.pageElement.question={id:e.get(),text:null,type:null,required:!0}):"image"==n.pageElement.type?n.pageElement.image||(n.pageElement.image={id:e.get(),align:"left"}):"paragraph"==n.pageElement.type&&(n.pageElement.paragraph||(n.pageElement.paragraph={id:e.get(),html:""}))},n.callback=function(e,o){e.preventDefault(),e.stopPropagation(),o.callback&&"function"==typeof o.callback&&o.callback(n.pageElement)},n.filter=function(e){return!(!e.showInOpen&&n.isActive)&&(!(!e.showInPreview&&!n.isActive)&&(!e.filter||"function"!=typeof e.filter||e.filter(n.pageElement)))},1===angular.version.major&&angular.version.minor<5&&n.$onInit()}],link:function(e,n,o,t){var r=e.ctrl;r.possiblePageFlow=t.possiblePageFlow,r.hoverIn=function(){r.isHovered=!0},r.hoverOut=function(){r.isHovered=!1},r.editElement=function(){t.selectElement(r.pageElement)},r.cloneElement=function(e){e.preventDefault(),e.stopPropagation(),t.cloneElement(r.pageElement)},r.removeElement=function(){t.removeElement(r.pageElement)},r.moveDown=function(){t.moveDownElement(r.pageElement)},r.moveUp=function(){t.moveUpElement(r.pageElement)},r.options=t.options,r.onImageSelection=t.onImageSelection}}}),angular.module("mwFormBuilder").directive("mwFormPageBuilder",["$rootScope",function(e){return{replace:!0,restrict:"AE",require:"^mwFormBuilder",scope:{formPage:"=",formObject:"=",isFirst:"=",isLast:"=",readOnly:"=?",uploadUrl:"="},templateUrl:"mw-form-page-builder.html",controllerAs:"ctrl",bindToController:!0,controller:["$timeout","mwFormUuid","mwFormClone","mwFormBuilderOptions","IScrollEvents","Upload","$q","$",function(n,o,t,r,i,a,l,s){function u(){for(var e=0;e<g.formPage.elements.length;e++)g.formPage.elements[e].orderNo=e+1}function m(){g.formPage.elements.sort(function(e,n){return e.orderNo-n.orderNo})}function d(){var e=null===g.activeElement,n=!0;if(e===!1){var o=g.activeElement[g.activeElement.type];switch(g.activeElement.type){case"question":n=null!=o.text&&null!=o.type,"radio"!==o.type&&"checkbox"!==o.type||(n=n!==!1&&o.offeredAnswers.length>1,o.offeredAnswers.forEach(function(e){n=n!==!1&&(null!=e.text&&""!==e.text||null!=e.value&&""!==e.value)}));break;case"image":n=null!=o.src;break;case"paragraph":n=""!==o.html&&null!=o.html}}return e||n}function c(e,n){return{id:o.get(),orderNo:n,type:e}}function f(e,n,o){var t=e[n];e.splice(n,1),e.splice(o,0,t)}var g=this,p=!1;g.$onInit=function(){g.hoverEdit=!1,g.formPage.namedPage=!!g.formPage.name,g.isFolded=!1,m(),g.sortableConfig={disabled:!0,ghostClass:"beingDragged",group:"survey",handle:".inactive",chosenClass:".page-element-list",onEnd:function(e,n){u()}},g.activeElement=null},g.unfold=function(){g.isFolded=!1},g.fold=function(){g.isFolded=!0},g.pageNameChanged=function(){e.$broadcast("mwForm.pageEvents.pageNameChanged",{page:g.formPage})},g.addElement=function(e,n){e||(e=r.elementTypes[0]);var o=c(e,g.formPage.elements.length+1);"image"===e&&(o.image={src:n}),g.activeElement=o,g.formPage.elements.push(o)},g.cloneElement=function(e,n){var o=g.formPage.elements.indexOf(e),r=t.cloneElement(e);n&&(g.activeElement=r),g.formPage.elements.splice(o,0,r)},g.removeElement=function(e){var n=g.formPage.elements.indexOf(e);g.formPage.elements.splice(n,1),g.activeElement=null},g.moveDownElement=function(e){var n=g.formPage.elements.indexOf(e),o=n+1;o<g.formPage.elements.length&&f(g.formPage.elements,n,o),u()},g.moveUpElement=function(e){var n=g.formPage.elements.indexOf(e),o=n-1;o>=0&&f(g.formPage.elements,n,o),u()},g.isElementTypeEnabled=function(e){return r.elementTypes.indexOf(e)!==-1},g.addQuestion=function(){d()===!0?(g.addElement("question"),p=!0):e.$emit("validateForm")},g.addImage=function(n){d()===!0?(g.addElement("image",n),p=!0):e.$emit("validateForm")},g.addParagraph=function(){d()===!0?(g.addElement("paragraph"),p=!0):e.$emit("validateForm")},g.isElementActive=function(e){return g.activeElement==e},g.selectElement=function(n){d()===!0?(e.$emit(i.REFRESH),g.activeElement=n,p=!0):g.activeElement.id!==n.id&&e.$emit("validateForm")},g.onElementReady=function(){n(function(){g.activeElement=null})},g.selectImageButtonClicked=function(n){if(n&&d()===!0){var o=[];return o.push(a.upload({url:g.uploadUrl,method:"POST",data:{file:n,maxWidth:876}}).then(function(e){g.addImage(e.data.filePath)})["catch"](function(e){return l.reject(e)})),l.all(o)}return e.$emit("validateForm"),l.reject("no images or uploadurl defined")},g.hoverIn=function(){g.hoverEdit=!0},g.hoverOut=function(){g.hoverEdit=!1},g.updateElementsOrderNo=u,1===angular.version.major&&angular.version.minor<5&&g.$onInit();var w=function(o){if(null!=g.activeElement&&p===!1){var t=o.target,r=null==t.closest(".mw-form-page-element-builder.active");r===!0&&(d()===!0?(g.activeElement=null,n(function(){e.$emit(i.REFRESH)},0)):e.$emit("validateForm"))}else p=!1};s(document).on("click",w),g.$onDestroy=function(){s(document).off("click",w)}}],link:function(e,n,o,t){var r=e.ctrl;r.possiblePageFlow=t.possiblePageFlow,r.moveDown=function(){t.moveDownPage(r.formPage)},r.moveUp=function(){t.moveUpPage(r.formPage)},r.removePage=function(){t.removePage(r.formPage)},r.addPage=function(){t.addPageAfter(r.formPage)},e.$watch("ctrl.formPage.elements.length",function(e,n){e!=n&&r.updateElementsOrderNo()}),r.options=t.options,r.onImageSelection=t.onImageSelection}}}]),angular.module("mwFormBuilder").factory("FormImageBuilderId",function(){var e=0;return{next:function(){return++e}}}).directive("mwFormImageBuilder",function(){return{replace:!0,restrict:"AE",require:"^mwFormPageElementBuilder",scope:{image:"=",formObject:"=",onReady:"&",isPreview:"=?",readOnly:"=?",onImageSelection:"&",uploadUrl:"="},templateUrl:"mw-form-image-builder.html",controllerAs:"ctrl",bindToController:!0,controller:["$timeout","FormImageBuilderId",function(e,n){var o=this;o.id=n.next(),o.formSubmitted=!1,o.save=function(){o.formSubmitted=!0,o.form.$valid&&o.onReady()},o.setAlign=function(e){o.image.align=e}}],link:function(e){e.ctrl}}}),angular.module("mwFormBuilder").directive("mwFormConfirmationPageBuilder",function(){return{replace:!0,restrict:"AE",scope:{formObject:"=",readOnly:"=?"},templateUrl:"mw-form-confirmation-page-builder.html",controllerAs:"ctrl",bindToController:!0,controller:["$timeout",function(e){var n=this;n.hoverEdit=!1,n.hoverIn=function(){n.hoverEdit=!0},n.hoverOut=function(){n.hoverEdit=!1}}],link:function(e,n,o){}}}),angular.module("mwFormBuilder").directive("mwFormBuilder",["$rootScope",function(e){return{replace:!0,restrict:"AE",scope:{formData:"=",readOnly:"=?",options:"=?",formStatus:"=?",onImageSelection:"&",api:"=?",uploadUrl:"="},templateUrl:"mw-form-builder.html",controllerAs:"ctrl",bindToController:!0,controller:["mwFormUuid","MW_QUESTION_TYPES","mwFormBuilderOptions",function(n,o,t){function r(e){var o=null;return l.possiblePageFlow&&(o=l.possiblePageFlow[0]),{id:n.get(),number:e,name:null,description:null,pageFlow:o,elements:[]}}function i(){for(var e=0;e<l.formData.pages.length;e++)l.formData.pages[e].number=e+1;l.updatePageFlow()}function a(e,n,o){var t=e[n];e.splice(n,1),e.splice(o,0,t)}var l=this;l.$onInit=function(){l.currentPage=0,l.formData.pages&&l.formData.pages.length||(l.formData.pages=[],l.formData.pages.push(r(1))),l.options=t.$init(l.options),l.api&&(l.api.reset=function(){for(var e in l.formData)l.formData.hasOwnProperty(e)&&"pages"!=e&&delete l.formData[e];l.formData.pages.length=0,l.formData.pages.push(r(1))})},l.numberOfPages=function(){return Math.ceil(l.formData.pages.length/l.options.pageSize)},l.lastPage=function(){l.currentPage=Math.ceil(l.formData.pages.length/l.options.pageSize-1)},l.addPage=function(){l.formData.pages.push(r(l.formData.pages.length+1)),l.lastPage(),e.$broadcast("mwForm.pageEvents.pageAdded")},l.onChangePageSize=function(){l.currentPage>Math.ceil(l.formData.pages.length/l.options.pageSize-1)&&(l.currentPage=Math.ceil(l.formData.pages.length/l.options.pageSize-1))},l.addPageAfter=function(n){var o=l.formData.pages.indexOf(n),t=o+1,a=r(n.number+1);t<l.formData.pages.length?l.formData.pages.splice(t,0,a):l.formData.pages.push(a),i(),e.$broadcast("mwForm.pageEvents.pageAdded")},l.moveDownPage=function(n){var o=l.formData.pages.indexOf(n),t=o+1;t<l.formData.pages.length&&a(l.formData.pages,o,t),i(),e.$broadcast("mwForm.pageEvents.pageMoved")},l.moveUpPage=function(n){var o=l.formData.pages.indexOf(n),t=o-1;t>=0&&a(l.formData.pages,o,t),i(),e.$broadcast("mwForm.pageEvents.pageMoved")},l.removePage=function(n){var o=l.formData.pages.indexOf(n);l.formData.pages.splice(o,1),i(),e.$broadcast("mwForm.pageEvents.pageRemoved"),l.onChangePageSize()},1===angular.version.major&&angular.version.minor<5&&l.$onInit()}],link:function(n,o,t){var r=n.ctrl;r.formStatus&&(r.formStatus.form=r.form),r.possiblePageFlow=[];var i={nextPage:!0,label:"target.mwForm.pageFlow.goToNextPage"};r.possiblePageFlow.push(i),r.isSamePageFlow=function(e,n){return e.page&&n.page&&e.page.id==n.page.id||e.formSubmit&&n.formSubmit||e.nextPage&&n.nextPage},r.updatePageFlow=function(){r.possiblePageFlow.length=1,r.formData.pages.forEach(function(e){r.possiblePageFlow.push({page:{id:e.id,number:e.number},label:"target.mwForm.pageFlow.goToPage"})}),r.possiblePageFlow.push({formSubmit:!0,label:"target.mwForm.pageFlow.submitForm"}),r.formData.pages.forEach(function(e){r.possiblePageFlow.forEach(function(n){e.pageFlow?r.isSamePageFlow(n,e.pageFlow)&&(e.pageFlow=n):e.pageFlow=i,e.elements.forEach(function(e){var o=e.question;o&&o.pageFlowModifier&&o.offeredAnswers.forEach(function(e){e.pageFlow&&r.isSamePageFlow(n,e.pageFlow)&&(e.pageFlow=n)})})})})},n.$watch("ctrl.formData.pages.length",function(e,n){r.updatePageFlow()}),n.$watch("ctrl.currentPage",function(n,o){e.$broadcast("mwForm.pageEvents.pageCurrentChanged",{index:r.currentPage})}),n.$on("mwForm.pageEvents.changePage",function(e,n){"undefined"!=typeof n.page&&n.page<r.numberOfPages()&&(r.currentPage=n.page)}),n.$on("mwForm.pageEvents.addPage",function(e,n){r.addPage()})}}}]),angular.module("mwFormBuilder").filter("mwStartFrom",function(){return function(e,n){return n=+n,e.slice(n)}}),angular.module("mwFormBuilder").constant("MW_QUESTION_TYPES",["textarea","radio","checkbox"]).constant("MW_ELEMENT_TYPES",["question","image","paragraph"]).constant("MW_GRID_CELL_INPUT_TYPES",["radio","checkbox","text","number","date","time"]).factory("mwFormBuilderOptions",["MW_ELEMENT_TYPES","MW_QUESTION_TYPES",function(e,n){function o(e,n){return e?e.map(function(e){return angular.extend({},n,e)}):[]}var t={title:null,icon:null,text:null,callback:null,filter:null,showInOpen:!1,showInPreview:!0,cssClass:""},r={key:null,label:null,selects:[],required:!0},i={elementTypes:e,questionTypes:n,elementButtons:[],pagesSize:[10,25,50,100],pageSize:10,customQuestionSelects:[],customElements:[]},a={$init:function(e){return angular.extend(a,i,e),a.customQuestionSelects=o(a.customQuestionSelects,r),a.elementButtons=o(a.elementButtons,t),a}};return a}]),angular.module("mwFormBuilder").directive("wdFocusMe",["$timeout","$parse",function(e,n){return{link:function(o,t,r){var i=n(r.wdFocusMe);o.$watch(i,function(n){n===!0&&e(function(){t[0].focus()})}),t.bind("blur",function(){e(function(){o.$apply(i.assign(o,!1))})})}}}]).factory("focus",["$timeout","$window",function(e,n){return function(o){e(function(){var e=n.document.getElementById(o);e&&e.focus()})}}]),angular.module("mwFormBuilder").directive("mwConfirmClick",["$window",function(e){return{restrict:"A",link:function(n,o,t){var r=t.wdConfirmClick||"Are you sure?";o.bind("click",function(o){e.confirm(r)&&n.$apply(t.confirmedAction)})}}}]);